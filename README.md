# NAS Playbook

This repository contains an Ansible playbook to transform your RaspberryPi 3 (and most UNIX-based systems like Ubuntu) into a NAS, supporting

* backups
  * encrypted file transfer (SSH)
  * key-based authentication (e.g. [backupnas](https://github.com/sebschlicht/backupnas) for UNIX clients, [FreeFileSync](https://freefilesync.org/) for Windows clients)
  * on a per-user basis
  * potentially mirrored to a second location
* flexible [Samba](https://www.samba.org/) shares for maximum compatibility
  * read/write access for UNIX-based, Windows and mobile clients
  * password authentication for users
  * password-free public shares for guests
  * *unencrypted file transfer*
* [DLNA](https://en.wikipedia.org/wiki/Digital_Living_Network_Alliance) access for your smartTV (among many)
  * play videos and/or music on UPnP devices
  * automatic discovery for all compatible devices
  * *unencrypted file transfer* (read-only)

## Usage

TBD: change configuration, run playbook

### Tags

Using the tags which are listed below, you can limit the features that are being installed on your target system.

For example, to just turn your system into a place for secure backups run:

    ansible-playbook -i hosts.yml --tags nas nas.yml

Tag | Description
--- | -----------
nas | Mounts hard drive(s) as (mirrored) backup location(s). Implies `sshd`.
sshd | Installs an OpenSSH server with reasonable security configuration.
dynv6 | Installs an update script to report your public IP address to DynV6 (dynamic DNS).
minidlna | Installs a miniDLNA server to access selected backup folders with compatible devices.
samba | Installs a Samba server to allow users to access their backup folders (and others) from any device.

## Ports

Instead of forwarding ports from your router to your NAS, you should strongly consider to use a VPN.

In case you still decide to go with port forwarding, the following ports are used by the particular service:

Service | TCP | UDP
------- | --- | ---
Samba   | 139, 445 | 137, 138
OpenSSH | 22  | 

These are the default ports.
Strongly-consider to expose the services at non-default ports to avoid the load and risk that is generated by bots.

## Hardening

TODO: move to GitHub wiki

The following steps have been applied in order to harden the NAS:

* harden SSH server
  * RSA public key authentication only
  * no forwarding
  * restricted to the created users

## Issues

TODO: move to GitHub issues

* [add firewall (e.g. `ufw`) together with `fail2ban`](https://www.raspberrypi.org/documentation/configuration/security.md) for users without a router with an integrated firewall
* check log analysis report options
* make Samba read-only, toggle write access via configuration
* (?) integrate with NextCloud to transform system into (backed up) cloud storage
  * Let's Encrypt
    * certificate renewal notification mail
